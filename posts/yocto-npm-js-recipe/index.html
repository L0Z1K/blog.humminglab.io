<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Yocto 에서 NPM 기반의 Javascript 패키지 관리 - All about IoT</title><meta name=Description content><meta property="og:url" content="https://blog.humminglab.io/posts/yocto-npm-js-recipe/">
<meta property="og:site_name" content="All about IoT"><meta property="og:title" content="Yocto 에서 NPM 기반의 Javascript 패키지 관리"><meta property="og:description" content="Yocto에서 Go 프로젝트 관리에 추가하여 JavaScript 기반의 프로그램을 Yocto의 패키지로 관리하는 방법을 정리해 본다.
관련 사항은 Yocto Wiki 의 NPM 기반 패키지 관리 방법에 간략하게 설명되어 있다.
TipsAndTricks/NPM - Yocto Project Javascript 기반의 프로젝트도 Go 언어와 마찬가지로 패키지 관련한 문제가 있지만 이 부분은 어느정도 툴을 이용하여 해결된 상태이다.
임베디드 환경에서 Javascript NPM 를 사용하는 경우를 크게 보면 다음 두 경우가 있을 수 있다.
Node.js 기반의 프로젝트 Webpack/React와 같은 static page 생성 Node."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-21T16:00:00+09:00"><meta property="article:modified_time" content="2023-08-21T16:00:00+09:00"><meta property="article:tag" content="Yocto"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="NPM"><meta property="article:tag" content="NodeJS"><meta property="article:tag" content="React"><meta property="article:tag" content="Webpack"><meta name=twitter:card content="summary"><meta name=twitter:title content="Yocto 에서 NPM 기반의 Javascript 패키지 관리"><meta name=twitter:description content="Yocto에서 Go 프로젝트 관리에 추가하여 JavaScript 기반의 프로그램을 Yocto의 패키지로 관리하는 방법을 정리해 본다.
관련 사항은 Yocto Wiki 의 NPM 기반 패키지 관리 방법에 간략하게 설명되어 있다.
TipsAndTricks/NPM - Yocto Project Javascript 기반의 프로젝트도 Go 언어와 마찬가지로 패키지 관련한 문제가 있지만 이 부분은 어느정도 툴을 이용하여 해결된 상태이다.
임베디드 환경에서 Javascript NPM 를 사용하는 경우를 크게 보면 다음 두 경우가 있을 수 있다.
Node.js 기반의 프로젝트 Webpack/React와 같은 static page 생성 Node."><meta name=application-name content="All about IoT"><meta name=apple-mobile-web-app-title content="All about IoT"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://blog.humminglab.io/posts/yocto-npm-js-recipe/><link rel=prev href=https://blog.humminglab.io/posts/yocto-golang-recipe/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Yocto 에서 NPM 기반의 Javascript 패키지 관리","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.humminglab.io\/posts\/yocto-npm-js-recipe\/"},"genre":"posts","keywords":"Yocto, Javascript, NPM, NodeJS, React, Webpack","wordcount":1118,"url":"https:\/\/blog.humminglab.io\/posts\/yocto-npm-js-recipe\/","datePublished":"2023-08-21T16:00:00+09:00","dateModified":"2023-08-21T16:00:00+09:00","publisher":{"@type":"Organization","name":"HummingLab"},"authors":[{"@type":"Person","name":"YSLee"}],"description":""}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop header-mobile><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="All about IoT">All about IoT</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://www.humminglab.io/ rel="noopener noreferrer" target=_blank>HummingLab </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="All about IoT">All about IoT</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://www.humminglab.io/ title rel="noopener noreferrer" target=_blank>HummingLab</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#esdk-and-devtool>eSDK and devtool</a></li><li><a href=#nodejs-기반의-프로젝트>Node.js 기반의 프로젝트</a><ul><li><a href=#nodejs-빌드-과정>Node.js 빌드 과정</a></li></ul></li><li><a href=#webpackreact와-같은-static-page-생성>Webpack/React와 같은 static page 생성</a></li><li><a href=#정리>정리</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Yocto 에서 NPM 기반의 Javascript 패키지 관리</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><span class="author fas fa-user-circle fa-fw"></span><span class=screen-reader-text> </span><a href=https://blog.humminglab.io/authors/yslee>YSLee</a></span>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=/categories/development/><i class="far fa-folder fa-fw"></i>Development</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-08-21>2023-08-21</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-08-21>2023-08-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1118 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#esdk-and-devtool>eSDK and devtool</a></li><li><a href=#nodejs-기반의-프로젝트>Node.js 기반의 프로젝트</a><ul><li><a href=#nodejs-빌드-과정>Node.js 빌드 과정</a></li></ul></li><li><a href=#webpackreact와-같은-static-page-생성>Webpack/React와 같은 static page 생성</a></li><li><a href=#정리>정리</a></li></ul></nav></div></div><div class=content id=content><p><a href=https://blog.humminglab.io/posts/yocto-golang-recipe/ rel>Yocto에서 Go 프로젝트 관리</a>에 추가하여 JavaScript 기반의 프로그램을 Yocto의 패키지로 관리하는 방법을 정리해 본다.</p><p>관련 사항은 Yocto Wiki 의 NPM 기반 패키지 관리 방법에 간략하게 설명되어 있다.</p><ul><li><a href=https://wiki.yoctoproject.org/wiki/TipsAndTricks/NPM target=_blank rel="noopener noreferrer">TipsAndTricks/NPM - Yocto Project</a></li></ul><p>Javascript 기반의 프로젝트도 Go 언어와 마찬가지로 패키지 관련한 문제가 있지만 이 부분은 어느정도 툴을 이용하여 해결된 상태이다.</p><p>임베디드 환경에서 Javascript NPM 를 사용하는 경우를 크게 보면 다음 두 경우가 있을 수 있다.</p><ul><li>Node.js 기반의 프로젝트</li><li>Webpack/React와 같은 static page 생성</li></ul><p>Node.js와 같은 프로젝트는 빌드 시 <code>nodejs-native</code> 도 필요하지만 target에서 동작하는 <code>nodejs</code>도 필요하다.
하지만 webpack과 같은 경우에는 <code>nodejs-native</code>만 있어서 configure, compile task에서 이를 이용하여 페이지를 생성하면 되고, 별도로 target에 <code>nodejs</code>를 설치할 필요가 없다.</p><p>둘은 recipe를 만드는 방법이 차이가 있어 이 둘을 구분하여 설명한다.</p><h2 id=esdk-and-devtool class=headerLink><a href=#esdk-and-devtool class=header-mark></a>eSDK and devtool</h2><p>위 TipsAndTricks/NPM 문서를 보면 devtool 을 이용하여 초기에 bitbake recipe를 생성한다.
이 devtool 이 만들어진 배경과 용도에 대해서 우선 간략히 설명한다.</p><p>Yocto 의 초기에는 SDK 빌드만 제공하였다. SDK 자체는 이해 하기가 명확하다.</p><p>간단하게 말하면 Yocto 기반의 rootfs image 위에서 개발하는 사람들을 위한 개발환경 이라고 할 수 있다.
Embedded linux system에 대해서만 알고 있으면 SDK를 이용하여 필요한 C, C++ 프로그램을 타겟용으로 빌드하여 실행 시키는 용도로, 해당 개발자는 Yocto 에 대해서 몰라도 된다.</p><p>우리가 보통 말하는 다음과 같은 툴체인을 빌드하는 것이라고 생각하면 된다.</p><ul><li><a href=https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads target=_blank rel="noopener noreferrer">Arm GNU Toolchain – Arm Developer</a></li><li><a href=https://www.linaro.org/downloads/ target=_blank rel="noopener noreferrer">Builds & Downloads | Linaro</a></li></ul><p>SDK 에는 다음과 같은 것들이 포함되어 있다.</p><ul><li>Cross-toolchain</li><li>Header & libraries</li><li>Debugging & tracing tools</li><li>System utilities</li><li>Package configuration tools</li><li>Documentation</li></ul><p>이들을 포함하여 설치 가능한 install script로 만들어 주는 것이 Yocto SDK 이다.</p><p>빌드 방법은 아래 처럼 사용하는 이미지에 <code>populate_sdk</code> task로 빌드할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bitbake core-image-minimal -c populate_sdk
</span></span></code></pre></td></tr></table></div></div><p>반면에 eSDK(Extensible Software Development Kit)는 C, C++ 프로그램 개발자가 아니라,
Yocto package 개발자를 위한 것이라고 볼 수 있다.</p><p>소규모 프로젝트라면 한 명의 Yocto 관리자가 있고, 나머지 개발자들은 SDK를 이용하여 프로그램을 개발 검증하여 repository에 넣어주면, yocto 관리자가 이를 위한 yocto 패키지를 업데이트하면 프로젝트 운영이 가능할 수 있다.</p><p>하지만 yocto 로 개발하는 부분이 더 큰 규모의 프로젝트라면 yocto 패키지를 여러명이 개발 하여야 할 수 있다. eSDK는 이를 위한 개발 환경이라고 보면 된다.
다수의 yocto 개발자가 원격 서버를 통하여 yocto 빌드를 관리하고, 로컬에서는 shared state(sstate) cache를 이용하여 사전에 빌드된 것은 패키지 관리자처럼 별도의 빌드없이 바로 사용 가능하고, 원하는 recipe를 편리하게 추가나 수정할 수 있는 기능을 제공한다.</p><p>빌드 방법은 SDK와 유사하지만 실제 사용방법은 그리 쉽지는 않다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bitbake core-image-minimal -c populate_sdk_ext
</span></span></code></pre></td></tr></table></div></div><p>eSDK는 2016년에 릴리즈된 <a href=https://wiki.yoctoproject.org/wiki/Extensible_SDK target=_blank rel="noopener noreferrer">Yocto Krogoth (2.1)</a> 부터 정식으로 포함되었고, 여기에 포함된 툴 중의 하나가 devtool 이다.</p><p>Devtool은 eSDK 환경 만이 아니라 yocto bitbake 빌드환경이면 기본 설치되어 있어, 일반 용도로 사용도 가능하다.</p><p>Devtool은 기본 동작은 다음과 같다.</p><ul><li>build/workspace 로 임시 작업 layer를 만들어서, 이를 build/conf/bblayer.conf에 추가한다.</li><li><code>devtool add</code>, <code>devtool modify</code> 와 같은 명령을 하면 이 workspace 안에 .bb 또는 .bbappend 파일을 만들고 관련된 소스들도 이곳에 설치하여 개발을 할 수 있도록 한다.</li><li>이때 cmake 처럼 표준화된 소스는 자동으로 recipe의 내용도 만들어 준다.</li></ul><p>Git 에 익숙한 사용자라면 git workspace 개념과 유사하다고 보면 된다. 수정은 workspace에서 하고, 최종적으로 작성이 완료되면 <code>devtool finish</code>를 이용하여 기존의 bitbake layer(local repository)로 commit 하는 구조라고 이해하면 된다.</p><p>NPM 기반의 소스코드도 devtool 에서 인식하여 recipe를 만들어 주어, 이를 이용하면 NPM 패키지를 쉽게 생성할 수 있다.</p><h2 id=nodejs-기반의-프로젝트 class=headerLink><a href=#nodejs-%ea%b8%b0%eb%b0%98%ec%9d%98-%ed%94%84%eb%a1%9c%ec%a0%9d%ed%8a%b8 class=header-mark></a>Node.js 기반의 프로젝트</h2><p>Node.js 기반의 프로젝트는 위에서 설명한 devtool을 활용하는 것이 좋다.
설치 절차는 <a href=https://wiki.yoctoproject.org/wiki/TipsAndTricks/NPM target=_blank rel="noopener noreferrer">TipsAndTricks/NPM - Yocto Project</a> 와 같은 동일한 예제로 설명한다.</p><p>초기에 recipe를 생성하는 것은 devtool을 이용하여 다음과 같이 실행한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ devtool add https://github.com/martinaglv/cute-files.git
</span></span><span class=line><span class=cl>NOTE: No setscene tasks
</span></span><span class=line><span class=cl>NOTE: Executing Tasks
</span></span><span class=line><span class=cl>NOTE: Tasks Summary: Attempted <span class=m>2</span> tasks of which <span class=m>0</span> didn<span class=err>&#39;</span>t need to be rerun and all succeeded.
</span></span><span class=line><span class=cl>NOTE: Checking <span class=k>if</span> npm is available ...
</span></span><span class=line><span class=cl>NOTE: Generating shrinkwrap file ...
</span></span><span class=line><span class=cl>NOTE: Fetching npm dependencies ...
</span></span><span class=line><span class=cl>NOTE: Handling licenses ...
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>실행이 성공하면 <code>build/workspace</code> 안에 파일들이 생성되고, <code>build/conf/bblayer.conf</code> 에도 workspace 가 추가된다.</p><p>Workspace의 파일 구성을 보면 다음과 같다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>workspace
</span></span><span class=line><span class=cl>├── README
</span></span><span class=line><span class=cl>├── appends
</span></span><span class=line><span class=cl>│   └── cute-files_git.bbappend
</span></span><span class=line><span class=cl>├── conf
</span></span><span class=line><span class=cl>│   └── layer.conf
</span></span><span class=line><span class=cl>├── recipes
</span></span><span class=line><span class=cl>│   └── cute-files
</span></span><span class=line><span class=cl>│       ├── cute-files
</span></span><span class=line><span class=cl>│       │   └── npm-shrinkwrap.json
</span></span><span class=line><span class=cl>│       └── cute-files_git.bb
</span></span><span class=line><span class=cl>└── sources
</span></span><span class=line><span class=cl>    └── cute-files
</span></span><span class=line><span class=cl>        ├── LICENSE
</span></span><span class=line><span class=cl>        ...
</span></span></code></pre></td></tr></table></div></div><p><code>recipes/cute-files/cute-files_git.bb</code>를 보면 다음과 같다. 내용을 이해하기 위하여 불필요한 줄은 삭제하였다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>SUMMARY</span> <span class=o>=</span> <span class=s2>&#34;Turn any folder on your computer into a cute file browser, available on the local network.&#34;</span>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span> <span class=o>=</span> <span class=s2>&#34;MIT &amp; Unknown &amp; ISC&#34;</span>
</span></span><span class=line><span class=cl><span class=n>LIC_FILES_CHKSUM</span> <span class=o>=</span> <span class=s2>&#34;file://LICENSE;md5=71d98c0a1db42956787b1909c74a86ca </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s2>                    file://node_modules/has/LICENSE-MIT;md5=d000afc3c9ff3501a5610197db76a246 </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s2>                    ...</span>
</span></span><span class=line><span class=cl>                    <span class=n>file</span><span class=p>:</span><span class=o>//</span><span class=n>node_modules</span><span class=o>/</span><span class=n>utils</span><span class=o>-</span><span class=n>merge</span><span class=o>/</span><span class=n>package</span><span class=o>.</span><span class=n>json</span><span class=p>;</span><span class=n>md5</span><span class=o>=</span><span class=mi>0230</span><span class=n>ade39b9c19f5fcc29ed02dff4afe</span> \
</span></span><span class=line><span class=cl>                    <span class=n>file</span><span class=p>:</span><span class=o>//</span><span class=n>node_modules</span><span class=o>/</span><span class=n>vary</span><span class=o>/</span><span class=n>package</span><span class=o>.</span><span class=n>json</span><span class=p>;</span><span class=n>md5</span><span class=o>=</span><span class=mi>3577</span><span class=n>fc17c1b964af7cfe2c17c73f84f3</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SRC_URI</span> <span class=o>=</span> <span class=s2>&#34; </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s2>    git://github.com/martinaglv/cute-files.git;protocol=https;branch=master </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s2>    npmsw://${THISDIR}/${BPN}/npm-shrinkwrap.json </span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s2>    &#34;</span>
</span></span><span class=line><span class=cl><span class=n>PV</span> <span class=o>=</span> <span class=s2>&#34;1.0.2+git${SRCPV}&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SRCREV</span> <span class=o>=</span> <span class=s2>&#34;98fe76448b8367adf206de6809b4adb7189b05ee&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>S</span> <span class=o>=</span> <span class=s2>&#34;${WORKDIR}/git&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inherit</span> <span class=n>npm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span><span class=p>:</span><span class=o>$</span><span class=p>{</span><span class=n>PN</span><span class=p>}</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span><span class=p>:</span><span class=o>$</span><span class=p>{</span><span class=n>PN</span><span class=p>}</span><span class=o>-</span><span class=n>accepts</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span><span class=p>:</span><span class=o>$</span><span class=p>{</span><span class=n>PN</span><span class=p>}</span><span class=o>-</span><span class=n>utils</span><span class=o>-</span><span class=n>merge</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span><span class=line><span class=cl><span class=n>LICENSE</span><span class=p>:</span><span class=o>$</span><span class=p>{</span><span class=n>PN</span><span class=p>}</span><span class=o>-</span><span class=n>vary</span> <span class=o>=</span> <span class=s2>&#34;MIT&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>위 파일을 보면 다음과 같은 사항을 확인할 수 있다.</p><ul><li>버전 변경 문제를 해결하기 위하여 <a href=https://docs.npmjs.com/cli/v8/commands/npm-shrinkwrap target=_blank rel="noopener noreferrer">npm-shrinkwrap</a> 을 이용하여 의존성있는 패키지의 버전을 고정시킨다.
파일은 <code>recipes/cute-files/cute-files/npm-shrinkwrap.json</code> 으로 생성된다.</li><li>패키지의 라이센스도 자동으로 확인하여 패키지별로 명시된다.</li></ul><p>이렇게 되면 <a href=https://docs.yoctoproject.org/test-manual/reproducible-builds.html target=_blank rel="noopener noreferrer">Reproducible Builds</a> 를 보장할 수 있고, 라이센스도 관리할 수 있다.</p><p><code>appends/cute-files_git.append</code> 를 보면 externalsrc를 이용하여 로컬 소스로 빌드가 가능하도록 설정되어 있다.
Externalsrc 에 대해서는 이전에 정리한 <a href=https://blog.humminglab.io/posts/yocto-project-on-orange-pi-3/ rel>Yocto Project 개발하기(3) - 개발 시 로컬 패키지 관리하기</a>를 참고할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>inherit externalsrc
</span></span><span class=line><span class=cl>EXTERNALSRC = &#34;/home/yslee/project/yocto-project/build/workspace/sources/cute-files&#34;
</span></span><span class=line><span class=cl>EXTERNALSRC_BUILD = &#34;/home/yslee/project/yocto-project/build/workspace/sources/cute-files&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># initial_rev: 98fe76448b8367adf206de6809b4adb7189b05ee
</span></span><span class=line><span class=cl>python do_configure:append() {
</span></span><span class=line><span class=cl>    pkgdir = d.getVar(&#34;NPM_PACKAGE&#34;)
</span></span><span class=line><span class=cl>    lockfile = os.path.join(pkgdir, &#34;singletask.lock&#34;)
</span></span><span class=line><span class=cl>    bb.utils.remove(lockfile)
</span></span></code></pre></td></tr></table></div></div><p>패키지 수정이 모두 완료 된 후에는 아래와 같이 필요한 layer로 옮길수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ devtool finish cute-files ../meta-my-project/recipes-core 
</span></span></code></pre></td></tr></table></div></div><h3 id=nodejs-빌드-과정 class=headerLink><a href=#nodejs-%eb%b9%8c%eb%93%9c-%ea%b3%bc%ec%a0%95 class=header-mark></a>Node.js 빌드 과정</h3><p>위와 같이 devtool을 이용하여 생성된 recipe는 <code>npm.bbclass</code>를 상속받아서 동작한다.
이 부분의 절차가 복잡하기는 한데, 간단하게 설명하면 다음과 같다.</p><ul><li>configure: 작업 파일에 npm-package로 패키지를 설치하고, npm package manager의 역할과 유사하게 npm-cache에는 의존성 있는 모든 패키지를 받아온다.</li><li>compile: <code>npm install</code> 과정을 수행한다. 이때 의존성 있는 패키지는 npm-cache 폴더를 참조하여 설치한다. 최종 결과물은 npm-build에 생성된다.</li><li>install: npm-build 결과물을 기반으로 설치 파일 추출</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ls tmp/work/cortexa7t2hf-neon-poky-linux-gnueabi/cute-files/1.0.2+git999-r0
</span></span><span class=line><span class=cl>npm-build  npm-cache  npm-package  recipe-sysroot  recipe-sysroot-native  temp
</span></span></code></pre></td></tr></table></div></div><p>만일 devtool로 정상적으로 인식되지 않는 repository 라면 위 생성된 것을 참조하여 유사하게 recipe 를 직접 만들어야 한다.</p><h2 id=webpackreact와-같은-static-page-생성 class=headerLink><a href=#webpackreact%ec%99%80-%ea%b0%99%ec%9d%80-static-page-%ec%83%9d%ec%84%b1 class=header-mark></a>Webpack/React와 같은 static page 생성</h2><p>이들 프로젝트에 대해서는 npm.bbclass 을 사용하기에는 오히려 더 복잡해진다.
이 경우에는 아래처럼 간단하게 recipe를 만들어 사용할 수 있다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SRC_URI = &#34; \
</span></span><span class=line><span class=cl>    git://git@gitlab.com/humminglab/test-react-frontend.git;protocol=ssh;branch=main \
</span></span><span class=line><span class=cl>    &#34;
</span></span><span class=line><span class=cl>SRCREV = &#34;${AUTOREV}&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>S = &#34;${WORKDIR}/git&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DEPENDS = &#34;nodejs-native&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NPM_NODEDIR ?= &#34;${RECIPE_SYSROOT_NATIVE}${prefix_native}&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_configure() {
</span></span><span class=line><span class=cl>    ${NPM_NODEDIR}/bin/npm install
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_compile() {
</span></span><span class=line><span class=cl>    ${NPM_NODEDIR}/bin/npm run build
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_install() {
</span></span><span class=line><span class=cl>    install -d ${D}${datadir}/www-pages
</span></span><span class=line><span class=cl>    cp -r ${S}/build/* ${D}${datadir}/www-pages
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>NPM과는 다음과 같은 차이가 있다.</p><ul><li>의존성은 <code>nodejs-native</code>만 명시</li><li>configure: 네트워크 접속이 가능하므로 <code>npm install</code> 로 webpack/react 등의 관련된 development package 설치</li><li>compile: <code>npm run build</code>로 static 결과물 생성</li><li>install: 생성된 파일들 추리기</li></ul><p>위와 같이 하면 target 의 <code>/usr/share/www-pages</code>에 생성된 파일들이 설치된다.</p><h2 id=정리 class=headerLink><a href=#%ec%a0%95%eb%a6%ac class=header-mark></a>정리</h2><p>Javascript 는 Yocto에서 어느정도 잘 관리되는 상태로 보여진다.
Go, Rust 등의 다른 패키지 관리자가 포함된 언어들도 Yocto 프로젝트가 버전업 되면서 이처럼 정리될 것으로 기대된다.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-21</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/yocto/>Yocto</a>,&nbsp;<a href=/tags/javascript/>Javascript</a>,&nbsp;<a href=/tags/npm/>NPM</a>,&nbsp;<a href=/tags/nodejs/>NodeJS</a>,&nbsp;<a href=/tags/react/>React</a>,&nbsp;<a href=/tags/webpack/>Webpack</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/yocto-golang-recipe/ class=prev rel=prev title="Yocto 에서 Go 프로젝트 관리"><i class="fas fa-angle-left fa-fw"></i>Yocto 에서 Go 프로젝트 관리</a></div></div><div id=comments><div id=giscus></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://giscus.app/>giscus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://www.humminglab.io target=_blank rel="noopener noreferrer">HummingLab</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{giscus:{darkTheme:"dark",dataCategory:"Announcements",dataCategoryId:"DIC_kwDOGdk00s4CAGXN",dataEmitMetadata:"0",dataInputPosition:"bottom",dataLang:"en",dataMapping:"pathname",dataReactionsEnabled:"1",dataRepo:"humminglab/blog.humminglab.io",dataRepoId:"R_kgDOGdk00g",dataStrict:"0",lightTheme:"light"}},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/giscus.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-83257319-3",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-83257319-3" async></script></div></body></html>